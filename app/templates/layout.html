<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>TechOnline | Shop</title>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#2563eb',
                        'secondary-blue': '#1d4ed8',
                        'accent-orange': '#f59e0b',
                        'neutral-gray': '#6b7280',
                        'background': '#f8fafc'
                    }
                }
            }
        }
    </script>
    <style>
        /* Minimal custom styles - most styling now handled by Tailwind */
        
        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .in-stock {
            background: #10b981;
            color: white;
        }
        
        .out-of-stock {
            background: #ef4444;
            color: white;
        }

        /* Global page loader overlay with three dots animation */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000; /* above header and dropdown */
            transition: opacity 0.2s ease;
        }

        .loader-dots {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loader-dots .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #111827; /* neutral black */
            animation: dotPulse 1s ease-in-out infinite;
        }

        .loader-dots .dot:nth-child(2) { animation-delay: 0.2s; }
        .loader-dots .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotPulse {
            0%, 80%, 100% {
                transform: scale(0.6);
                opacity: 0.4;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-background font-sans m-0 p-0">
    <!-- Global Page loader overlay -->
    <div id="pageLoader" class="loader-overlay" aria-hidden="true">
        <div class="loader-dots">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </div>
    {% block content %}
    <header class="bg-gradient-to-br from-primary-blue to-secondary-blue text-white py-4 shadow-lg">
        <div class="max-w-6xl mx-auto px-8 flex justify-between items-center flex-wrap gap-4">
            <h1 class="text-4xl font-black m-0 cursor-pointer transition-transform duration-300 ease-in-out hover:scale-105">tech<span class="text-accent-orange">O</span>nline</h1>
            
            <form class="flex gap-2 flex-1 max-w-lg mx-8" method="post" action="{{ url_for('shop') }}">
                <input type="search" 
                       name="product_name" 
                       class="flex-1 px-4 py-3 border-0 rounded-full text-base outline-none shadow-md" 
                       placeholder="Search for products..." 
                       value="{{ search_query or '' }}">
                <button type="submit" class="bg-accent-orange text-white border-0 px-6 py-3 rounded-full cursor-pointer font-semibold transition-all duration-300 ease-in-out shadow-md hover:bg-yellow-600 hover:-translate-y-0.5 hover:shadow-lg">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
            
            <div class="relative ml-auto">
                <button id="headerDropdownBtn" class="flex items-center gap-2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-2xl font-medium transition-all duration-300 ease-in-out">
                    <i class="fas fa-bars"></i>
                    Menu
                    <i class="fas fa-chevron-down text-sm"></i>
                </button>
                <div id="headerDropdownMenu" class="hidden absolute right-0 top-full mt-2 w-52 bg-white text-black rounded-xl shadow-xl overflow-hidden">
                    <a href="{{ url_for('customer_profile') }}" class="block px-4 py-3 hover:bg-background no-underline text-black"><i class="fas fa-user mr-2"></i> Profile</a>
                    <a href="{{ url_for('product_form') }}" class="block px-4 py-3 hover:bg-background no-underline text-black"><i class="fas fa-plus mr-2"></i> Add Product</a>
                    <a href="{{ url_for('cart') }}" class="block px-4 py-3 hover:bg-background no-underline text-black"><i class="fas fa-shopping-cart mr-2"></i> Cart</a>
                    <a href="{{ url_for('logout') }}" class="block px-4 py-3 hover:bg-background no-underline text-black"><i class="fas fa-sign-out-alt mr-2"></i> Logout</a>
                </div>
            </div>
        </div>
    </header>
    
    <main class="max-w-6xl mx-auto my-8 px-8">
        {% if search_query %}
        <div class="bg-white p-4 rounded-lg mb-8 shadow-lg">
            <h3><i class="fas fa-search"></i> Search Results for "{{ search_query }}"</h3>
            <p>Found {{ products|length }} product(s)</p>
        </div>
        {% else %}
        <div class="text-center mb-8 text-black">
            <h2>Our Products</h2>
            <p>Discover the latest tech products</p>
        </div>
        {% endif %}
        
        {% if products %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 mt-8">
            {% for product in products %}
            <div class="bg-white rounded-2xl overflow-hidden shadow-lg transition-all duration-300 ease-in-out cursor-pointer hover:-translate-y-1 hover:shadow-xl">
                <div class="relative">
                    {% if product.product_image %}
                    <img src="{{ product.product_image }}" alt="{{ product.product_name }}" class="w-full h-48 object-cover">
                    {% else %}
                    <div class="w-full h-48 flex items-center justify-center bg-background">
                        <i class="fas fa-image text-5xl text-neutral-gray"></i>
                    </div>
                    {% endif %}
                    
                    {% if product.stock_quantity is defined %}
                        {% if product.stock_quantity > 0 %}
                        <span class="stock-badge in-stock">In Stock</span>
                        {% else %}
                        <span class="stock-badge out-of-stock">Out of Stock</span>
                        {% endif %}
                    {% endif %}
                </div>
                
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-black mb-2">{{ product.product_name }}</h3>
                    
                    {% if product.description %}
                    <p class="text-neutral-gray text-sm leading-relaxed mb-4 line-clamp-3">{{ product.description }}</p>
                    {% endif %}
                    
                    {% if product.price is defined %}
                    <div class="text-2xl font-bold text-primary-blue mb-4">${{ "%.2f"|format(product.price) }}</div>
                    {% endif %}
                    
                    <div class="flex gap-2">
                        <button class="bg-primary-blue text-white border-0 px-4 py-3 rounded-lg cursor-pointer font-semibold transition-all duration-300 ease-in-out flex-1 hover:bg-secondary-blue hover:-translate-y-0.5" onclick="viewProduct('{{ product.id }}')">View Details</button>
                        {% if product.stock_quantity is defined and product.stock_quantity > 0 %}
                        <button class="bg-accent-orange text-white border-0 px-4 py-3 rounded-lg cursor-pointer font-semibold transition-all duration-300 ease-in-out hover:bg-yellow-600 hover:-translate-y-0.5" onclick='addToCart({{ {"id": product.id, "name": product.product_name, "price": product.price, "image": product.product_image }|tojson }})'>Add to Cart</button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 text-neutral-gray">
            <i class="fas fa-box-open text-6xl mb-4 text-neutral-gray"></i>
            <h3>No Products Found</h3>
            {% if search_query %}
            <p>No products match your search for "{{ search_query }}". Try different keywords.</p>
            <a href="{{ url_for('shop') }}" class="bg-primary-blue text-white border-0 px-4 py-3 rounded-lg cursor-pointer font-semibold transition-all duration-300 ease-in-out hover:bg-secondary-blue hover:-translate-y-0.5 inline-block mt-4 no-underline">View All Products</a>
            {% else %}
            <p>No products are currently available. Check back later!</p>
            {% endif %}
        </div>
        {% endif %}
    </main>
    {% endblock content %}
    
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script>
        // Hide page loader when content is fully loaded
        window.addEventListener('load', function () {
            var loader = document.getElementById('pageLoader');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(function () { loader.style.display = 'none'; }, 200);
            }
        });

        // Header dropdown toggle
        (function() {
            const btn = document.getElementById('headerDropdownBtn');
            const menu = document.getElementById('headerDropdownMenu');
            if (btn && menu) {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('hidden');
                });
                document.addEventListener('click', () => {
                    menu.classList.add('hidden');
                });
            }
        })();

        function viewProduct(productId) {
            // Navigate to product details page
            window.location.href = `/product/${productId}`;
        }
        
        async function addToCart(product) {
            // Server-side cart using database
            try {
                const res = await fetch('/cart/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_id: product.id, quantity: 1 })
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed to add to cart');
                showNotification('Product added to cart!', 'success');
            } catch (e) {
                console.error('Error:', e);
                showNotification('Error adding product to cart', 'error');
            }
        }
        
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                background: ${type === 'success' ? 'var(--success-green)' : 'var(--error-red)'};
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>